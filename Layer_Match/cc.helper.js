"undefined"==typeof cc&&(cc={}),cc.helper=function(){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var t=function Node(t,e){_classCallCheck(this,Node),this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function DEFAULT_COMPARE(t,e){return t>e?1:t<e?-1:0}function splay(e,n,r){for(var i=new t(null,null),o=i,s=i;;){var l=r(e,n.key);if(l<0){if(null===n.left)break;if(r(e,n.left.key)<0){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}s.left=n,s=n,n=n.left}else{if(!(l>0))break;if(null===n.right)break;if(r(e,n.right.key)>0){var h=n.right;if(n.right=h.left,h.left=n,null===(n=h).right)break}o.right=n,o=n,n=n.right}}return o.right=n.left,s.left=n.right,n.left=i.right,n.right=i.left,n}function _insert(e,n,r,i){var o=new t(e,n);if(null===r)return o.left=o.right=null,o;r=splay(e,r,i);var s=i(e,r.key);return s<0?(o.left=r.left,o.right=r,r.left=null):s>=0&&(o.right=r.right,o.left=r,r.right=null),o}function _split(t,e,n){var r=null,i=null;if(e){e=splay(t,e,n);var o=n(e.key,t);0===o?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}var e=function(){function Tree(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_COMPARE;_classCallCheck(this,Tree),this._root=null,this._size=0,this._comparator=t}return _createClass(Tree,[{key:"insert",value:function(t,e){return this._size++,this._root=_insert(t,e,this._root,this._comparator)}},{key:"add",value:function(e,n){var r=new t(e,n);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,o=splay(e,this._root,i),s=i(e,o.key);return 0===s?this._root=o:(s<0?(r.left=o.left,r.right=o,o.left=null):s>0&&(r.right=o.right,r.left=o,o.right=null),this._size++,this._root=r),this._root}},{key:"remove",value:function(t){this._root=this._remove(t,this._root,this._comparator)}},{key:"_remove",value:function(t,e,n){var r;if(null===e)return null;e=splay(t,e,n);var i=n(t,e.key);return 0===i?(null===e.left?r=e.right:(r=splay(t,e.left,n)).right=e.right,this._size--,r):e}},{key:"pop",value:function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=splay(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null}},{key:"findStatic",value:function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}},{key:"find",value:function(t){return this._root&&(this._root=splay(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}},{key:"contains",value:function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}},{key:"forEach",value:function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}},{key:"range",value:function(t,e,n,r){for(var i=[],o=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(s=i.pop(),o(s.key,e)>0)break;if(o(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this}},{key:"keys",value:function(){var t=[];return this.forEach(function(e){var n=e.key;return t.push(n)}),t}},{key:"values",value:function(){var t=[];return this.forEach(function(e){var n=e.data;return t.push(n)}),t}},{key:"min",value:function(){return this._root?this.minNode(this._root).key:null}},{key:"max",value:function(){return this._root?this.maxNode(this._root).key:null}},{key:"minNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.left;)t=t.left;return t}},{key:"maxNode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._root;if(t)for(;t.right;)t=t.right;return t}},{key:"at",value:function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}},{key:"next",value:function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}},{key:"prev",value:function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}},{key:"clear",value:function(){return this._root=null,this._size=0,this}},{key:"toList",value:function(){return function(e){for(var n=e,r=[],i=!1,o=new t(null,null),s=o;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=s=s.next=r.pop()).right:i=!0;return s.next=null,o.next}(this._root)}},{key:"load",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.length,o=this._comparator;if(r&&function sort(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],s=n-1,l=r+1;;){do{s++}while(i(t[s],o)<0);do{l--}while(i(t[l],o)>0);if(s>=l)break;var u=t[s];t[s]=t[l],t[l]=u,u=e[s],e[s]=e[l],e[l]=u}sort(t,e,n,l,i),sort(t,e,l+1,r,i)}}(e,n,0,i-1,o),null===this._root)this._root=function loadRecursive(e,n,r,i){var o=i-r;if(o>0){var s=r+Math.floor(o/2),l=e[s],u=n[s],h=new t(l,u);return h.left=loadRecursive(e,n,r,s),h.right=loadRecursive(e,n,s+1,i),h}return null}(e,n,0,i),this._size=i;else{var s=function(e,n,r){for(var i=new t(null,null),o=i,s=e,l=n;null!==s&&null!==l;)r(s.key,l.key)<0?(o.next=s,s=s.next):(o.next=l,l=l.next),o=o.next;return null!==s?o.next=s:null!==l&&(o.next=l),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,o=0;o<e.length;o++)i=i.next=new t(e[o],n[o]);return i.next=null,r.next}(e,n),o);i=this._size+i,this._root=function sortedListToBST(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=sortedListToBST(t,e,i),s=t.head;return s.left=o,t.head=t.head.next,s.right=sortedListToBST(t,i+1,n),s}return null}({head:s},0,i)}return this}},{key:"isEmpty",value:function(){return null===this._root}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t){return String(t.key)},e=[];return function printRow(t,e,n,r,i){if(t){r("".concat(e).concat(n?"└── ":"├── ").concat(i(t),"\n"));var o=e+(n?"    ":"│   ");t.left&&printRow(t.left,o,!1,r,i),t.right&&printRow(t.right,o,!0,r,i)}}(this._root,"",!0,function(t){return e.push(t)},t),e.join("")}},{key:"update",value:function(t,e,n){var r=this._comparator,i=_split(t,this._root,r),o=i.left,s=i.right;r(t,e)<0?s=_insert(e,n,s,r):o=_insert(e,n,o,r),this._root=function(t,e,n){return null===e?t:null===t?e:((e=splay(t.key,e,n)).left=t,e)}(o,s,r)}},{key:"split",value:function(t){return _split(t,this._root,this._comparator)}},{key:"size",get:function(){return this._size}},{key:"root",get:function(){return this._root}}]),Tree}(),n=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},r=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,o=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:o}}},i=Number.EPSILON;void 0===i&&(i=Math.pow(2,-52));var o=i*i,s=function(t,e){if(-i<t&&t<i&&-i<e&&e<i)return 0;var n=t-e;return n*n<o*t*e?0:t<e?-1:1},l=function(){function PtRounder(){_classCallCheck(this,PtRounder),this.reset()}return _createClass(PtRounder,[{key:"reset",value:function(){this.xRounder=new u,this.yRounder=new u}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),PtRounder}(),u=function(){function CoordRounder(){_classCallCheck(this,CoordRounder),this.tree=new e,this.round(0)}return _createClass(CoordRounder,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===s(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===s(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),CoordRounder}(),h=new l,a=function(t,e){return t.x*e.y-t.y*e.x},f=function(t,e){return t.x*e.x+t.y*e.y},c=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=a(r,i);return s(o,0)},v=function(t){return Math.sqrt(f(t,t))},y=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return f(i,r)/v(i)/v(r)},g=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},p=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},x=function(){function SweepEvent(t,e){_classCallCheck(this,SweepEvent),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}return _createClass(SweepEvent,null,[{key:"compare",value:function(t,e){var n=SweepEvent.comparePoints(t.point,e.point);return 0!==n?n:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:d.compare(t.segment,e.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),_createClass(SweepEvent,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,s,l,u,h=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,s=h.point,l={x:o.x-i.x,y:o.y-i.y},u={x:s.x-i.x,y:s.y-i.y},a(u,l)/v(u)/v(l)),cosine:y(e.point,t.point,h.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,l=n.get(e),u=l.sine,h=l.cosine;return o>=0&&u>=0?s<h?1:s>h?-1:0:o<0&&u<0?s<h?-1:s>h?1:0:u<o?-1:u>o?1:0}}}]),SweepEvent}(),_=0,d=function(){function Segment(t,e,n,r){_classCallCheck(this,Segment),this.id=++_,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=n,this.windings=r}return _createClass(Segment,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,l=e.leftSE.point.y,u=t.rightSE.point.y,h=e.rightSE.point.y;if(n<r){if(l<s&&l<u)return 1;if(l>s&&l>u)return-1;var a=t.comparePoint(e.leftSE.point);if(a<0)return 1;if(a>0)return-1;var f=e.comparePoint(t.rightSE.point);return 0!==f?f:-1}if(n>r){if(s<l&&s<h)return-1;if(s>l&&s>h)return 1;var c=e.comparePoint(t.leftSE.point);if(0!==c)return c;var v=t.comparePoint(e.rightSE.point);return v<0?1:v>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(i<o){var y=e.comparePoint(t.rightSE.point);if(0!==y)return y}if(i>o){var g=t.comparePoint(e.rightSE.point);if(g<0)return 1;if(g>0)return-1}if(i!==o){var p=u-s,x=i-n,_=h-l,d=o-r;if(p>x&&_<d)return 1;if(p<x&&_>d)return-1}return i>o?1:i<o?-1:u<h?-1:u>h?1:t.id<e.id?-1:t.id>e.id?1:0}}]),_createClass(Segment,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,l=e.y+s*r.y;return t.y===l?0:t.y<l?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),i=t.bbox(),o=r(e,i);if(null===o)return null;var s=this.leftSE.point,l=this.rightSE.point,u=t.leftSE.point,f=t.rightSE.point,c=n(e,u)&&0===this.comparePoint(u),v=n(i,s)&&0===t.comparePoint(s),y=n(e,f)&&0===this.comparePoint(f),x=n(i,l)&&0===t.comparePoint(l);if(v&&c)return x&&!y?l:!x&&y?f:null;if(v)return y&&s.x===f.x&&s.y===f.y?null:s;if(c)return x&&l.x===u.x&&l.y===u.y?null:u;if(x&&y)return null;if(x)return l;if(y)return f;var _=function(t,e,n,r){if(0===e.x)return p(n,r,t.x);if(0===r.x)return p(t,e,n.x);if(0===e.y)return g(n,r,t.y);if(0===r.y)return g(t,e,n.y);var i=a(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=a(o,e)/i,l=a(o,r)/i,u=t.x+l*e.x,h=n.x+s*r.x,f=t.y+l*e.y,c=n.y+s*r.y;return{x:(u+h)/2,y:(f+c)/2}}(s,this.vector(),u,t.vector());return null===_?null:n(o,_)?h.round(_.x,_.y):null}},{key:"split",value:function(t){var e=[],n=void 0!==t.events,r=new x(t,!0),i=new x(t,!1),o=this.rightSE;this.replaceRightSE(i),e.push(i),e.push(r);var s=new Segment(r,o,this.rings.slice(),this.windings.slice());return x.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),x.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),i.checkForConsuming()),e}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){for(var e=this,n=t;e.consumedBy;)e=e.consumedBy;for(;n.consumedBy;)n=n.consumedBy;var r=Segment.compare(e,n);if(0!==r){if(r>0){var i=e;e=n,n=i}if(e.prev===n){var o=e;e=n,n=o}for(var s=0,l=n.rings.length;s<l;s++){var u=n.rings[s],h=n.windings[s],a=e.rings.indexOf(u);-1===a?(e.rings.push(u),e.windings.push(h)):e.windings[a]+=h}n.rings=null,n.windings=null,n.consumedBy=e,n.leftSE.consumedBy=e.leftSE,n.rightSE.consumedBy=e.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],l=this.windings[i],u=e.indexOf(s);-1===u?(e.push(s),n.push(l)):n[u]+=l}for(var h=[],a=[],f=0,c=e.length;f<c;f++)if(0!==n[f]){var v=e[f],y=v.poly;if(-1===a.indexOf(y))if(v.isExterior)h.push(y);else{-1===a.indexOf(y)&&a.push(y);var g=h.indexOf(v.poly);-1!==g&&h.splice(g,1)}}for(var p=0,x=h.length;p<x;p++){var _=h[p].multiPoly;-1===r.indexOf(_)&&r.push(_)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(C.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===C.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var l=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=l(t)!==l(e);break;default:throw new Error("Unrecognized operation type found ".concat(C.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,e,n){var r,i,o,s=x.comparePoints(t,e);if(s<0)r=t,i=e,o=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));r=e,i=t,o=-1}var l=new x(r,!0),u=new x(i,!1);return new Segment(l,u,[n],[o])}}]),Segment}(),E=function(){function RingIn(t,e,n){if(_classCallCheck(this,RingIn),!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=h.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var i=r,o=1,s=t.length;o<s;o++){if("number"!=typeof t[o][0]||"number"!=typeof t[o][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=h.round(t[o][0],t[o][1]);l.x===i.x&&l.y===i.y||(this.segments.push(d.fromRing(i,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),i=l)}r.x===i.x&&r.y===i.y||this.segments.push(d.fromRing(i,r,this))}return _createClass(RingIn,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),RingIn}(),m=function(){function PolyIn(t,e){if(_classCallCheck(this,PolyIn),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new E(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,r=t.length;n<r;n++){var i=new E(t[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}return _createClass(PolyIn,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),PolyIn}(),b=function(){function MultiPolyIn(t,e){if(_classCallCheck(this,MultiPolyIn),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,r=t.length;n<r;n++){var i=new m(t[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}return _createClass(MultiPolyIn,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),MultiPolyIn}(),k=function(){function RingOut(t){_classCallCheck(this,RingOut),this.events=t;for(var e=0,n=t.length;e<n;e++)t[e].segment.ringOut=this;this.poly=null}return _createClass(RingOut,null,[{key:"factory",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(i.isInResult()&&!i.ringOut){for(var o=null,s=i.leftSE,l=i.rightSE,u=[s],h=s.point,a=[];o=s,s=l,u.push(s),s.point!==h;)for(;;){var f=s.getAvailableLinkedEvents();if(0===f.length){var c=u[0].point,v=u[u.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(c.x,",")+" ".concat(c.y,"]. Last matching segment found ends at")+" [".concat(v.x,", ").concat(v.y,"]."))}if(1===f.length){l=f[0].otherSE;break}for(var y=null,g=0,p=a.length;g<p;g++)if(a[g].point===s.point){y=g;break}if(null===y){a.push({index:u.length,point:s.point});var x=s.getLeftmostComparator(o);l=f.sort(x)[0].otherSE;break}var _=a.splice(y)[0],d=u.splice(_.index);d.unshift(d[0].otherSE),e.push(new RingOut(d.reverse()))}e.push(new RingOut(u))}}return e}}]),_createClass(RingOut,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==c(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],l=e[1];0===c(s,t,l)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,f=[],v=h;v!=a;v+=u)f.push([e[v].x,e[v].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];x.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),RingOut}(),S=function(){function PolyOut(t){_classCallCheck(this,PolyOut),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return _createClass(PolyOut,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),PolyOut}(),w=function(){function MultiPolyOut(t){_classCallCheck(this,MultiPolyOut),this.rings=t,this.polys=this._composePolys(t)}return _createClass(MultiPolyOut,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new S(i));else{var o=i.enclosingRing();o.poly||e.push(new S(o)),o.poly.addInterior(i)}}return e}}]),MultiPolyOut}(),R=function(){function SweepLine(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.compare;_classCallCheck(this,SweepLine),this.queue=t,this.tree=new e(n),this.segments=[]}return _createClass(SweepLine,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,l=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===l;)null===(o=this.tree.next(o))?l=null:void 0===o.key.consumedBy&&(l=o.key);if(t.isLeft){var u=null;if(s){var h=s.getIntersection(e);if(null!==h&&(e.isAnEndpoint(h)||(u=h),!s.isAnEndpoint(h)))for(var a=this._splitSafely(s,h),f=0,c=a.length;f<c;f++)n.push(a[f])}var v=null;if(l){var y=l.getIntersection(e);if(null!==y&&(e.isAnEndpoint(y)||(v=y),!l.isAnEndpoint(y)))for(var g=this._splitSafely(l,y),p=0,_=g.length;p<_;p++)n.push(g[p])}if(null!==u||null!==v){var d=null;if(null===u)d=v;else if(null===v)d=u;else{var E=x.comparePoints(u,v);d=E<=0?u:v}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var m=e.split(d),b=0,k=m.length;b<k;b++)n.push(m[b])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&l){var S=s.getIntersection(l);if(null!==S){if(!s.isAnEndpoint(S))for(var w=this._splitSafely(s,S),R=0,P=w.length;R<P;R++)n.push(w[R]);if(!l.isAnEndpoint(S))for(var I=this._splitSafely(l,S),C=0,O=I.length;C<O;C++)n.push(I[C])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),SweepLine}(),P="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,I="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,C=new(function(){function Operation(){_classCallCheck(this,Operation)}return _createClass(Operation,[{key:"run",value:function(t,n,i){C.type=t,h.reset();for(var o=[new b(n,!0)],s=0,l=i.length;s<l;s++)o.push(new b(i[s],!1));if(C.numMultiPolys=o.length,"difference"===C.type)for(var u=o[0],a=1;a<o.length;)null!==r(o[a].bbox,u.bbox)?a++:o.splice(a,1);if("intersection"===C.type)for(var f=0,c=o.length;f<c;f++)for(var v=o[f],y=f+1,g=o.length;y<g;y++)if(null===r(v.bbox,o[y].bbox))return[];for(var p=new e(x.compare),_=0,d=o.length;_<d;_++)for(var E=o[_].getSweepEvents(),m=0,S=E.length;m<S;m++)if(p.insert(E[m]),p.size>P)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var O=new R(p),L=p.size,N=p.pop();N;){var A=N.key;if(p.size===L){var M=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(M.id," ")+"[".concat(M.leftSE.point.x,", ").concat(M.leftSE.point.y,"] -> ")+"[".concat(M.rightSE.point.x,", ").concat(M.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>P)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(O.segments.length>I)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var T=O.process(A),B=0,z=T.length;B<z;B++){var G=T[B];void 0===G.consumedBy&&p.insert(G)}L=p.size,N=p.pop()}h.reset();var F=k.factory(O.segments),U=new w(F);return U.getGeom()}}]),Operation}());return{xor:function(t){const e=[];t.forEach(t=>{const n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);e.push([n])});let n=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return C.run("xor",t,n)}(...e),r=Number.MAX_VALUE,i=Number.MAX_VALUE;return n.forEach(t=>{t.forEach(t=>{t.forEach(t=>{t[0]<r&&(r=t[0]),t[1]<i&&(i=t[1])})})}),n.forEach(t=>{t.forEach(t=>{t.forEach(t=>{t[0]-=r,t[1]-=i})})}),n}}}();