!function(){"use strict";class e extends Laya.Script{constructor(){super(...arguments),this.sx=1,this.sy=1}onAwake(){this.filter=new Laya.ColorFilter,this.filter.adjustBrightness(-20),this.sx=this.owner.scaleX,this.sy=this.owner.scaleY}onMouseDown(){this.owner.scale(.95*this.sx,.95*this.sy),this.owner.filters=[this.filter]}onMouseUp(){this.owner.scale(this.sx,this.sy),this.owner.filters=[]}onMouseOut(){this.owner.scale(this.sx,this.sy),this.owner.filters=[]}}class t extends Laya.EventDispatcher{constructor(){super()}offAllCaller(e){return this.data&&this.data.offAllCaller(e),super.offAllCaller(e)}getStorageSync(e){let t=Laya.LocalStorage.getItem(e);return JSON.parse(t)}setStorageSync(e,t){return Laya.LocalStorage.setItem(e,JSON.stringify(t))}}class i extends Laya.EventDispatcher{constructor(){super(...arguments),this.m_values={}}push(e,t){e in this.m_values||(this.m_values[e]=new s),this.m_values[e].value=t}value(e){return this.m_values[e]?this.m_values[e].value:null}toDefault(){Object.keys(this.m_values).forEach(e=>{this.m_values[e].toDefault()})}define(e,t=null){return e in this.m_values||(this.m_values[e]=new s,this.m_values[e].value=t,this.m_values[e].defaultValue=t),this.m_values[e]}}class s{constructor(){this.m_dispatcher=new Laya.EventDispatcher}get beforValue(){return this.beforeValue_}get value(){return this.m_value}set value(e){this.m_value!==e&&(this.beforeValue_=this.m_value,this.m_value=e,this.event([this.m_value,this.beforeValue_]))}toDefault(){this.m_value=this.beforeValue_=this.defaultValue}event(e){this.m_dispatcher.event("ivalue_event",e)}on(e,t,i){this.m_dispatcher.on("ivalue_event",e,t,i)}off(e,t){this.m_dispatcher.off("ivalue_event",e,t,!1)}}class a extends i{get soundMuted(){return this.define("soundMuted",!1)}get musicMuted(){return this.define("musicMuted",!1)}get firstOpen(){return this.define("firstOpen",!0)}get blueCardLevel(){return this.define("blueCardLevel",1)}get redCardLevel(){return this.define("redCardLevel",1)}get yellowCardLevel(){return this.define("yellowCardLevel",1)}get bestScore(){return this.define("bestScore",0)}}class l{constructor(){this.typeList=[],this.levelList=[]}}class n extends i{get scene(){return this.define("scene",null)}get layers(){return this.define("layers",{})}}var h,o,r;!function(e){e.teach="Layer/Teach.scene",e.gameOver="Layer/GameOver.scene",e.tips="Layer/Tips.scene",e.skillTips="Layer/SkillTips.scene",e.getSkillTip="Layer/GetSkillTip.scene"}(h||(h={}));class c extends Laya.EventDispatcher{constructor(){super()}static getInstance(){return this._instance||(this._instance=new c,this._instance.initData()),this._instance}onAwake(){}initData(){this.data=new n}openScene(e,t){Laya.Scene.load(e,Laya.Handler.create(this,this.onSceneLoaded,[e,t])),Laya.Scene.open}onSceneLoaded(e,t,i){i._param=t,i.open(!1,t),this.data.scene.value&&this.data.scene.value.removeSelf(),this.data.scene.value=i}openLayer(e,t,i=!1){Laya.Scene.open(e,!1,t,Laya.Handler.create(this,this.openLayerComplete,[e,i]))}closeLayer(e){let t=null;if(e instanceof Laya.Node){const i=Object.keys(h);for(let s=0;s<i.length;s++)if(this.data.layers[i[s]]===e){t=i[s],delete this.data.layers[i[s]],e instanceof Laya.Dialog?e.close():e.removeSelf();break}}else t=e,this.data.layers[e]&&(this.data.layers[e]instanceof Laya.Dialog?this.data.layers[e].close():this.data.layers[e].removeSelf(),delete this.data.layers[e]);this.data.layers.event(Laya.Event.REMOVED)}closeAllLayers(){for(const e in h)this.closeLayer(h[e])}openLayerComplete(e,t,i){if(this.data.layers[e]&&this.data.layers[e].removeSelf(),t)for(const e in h)console.log("aaaaa",h[e]),this.closeLayer(h[e]);this.data.layers[e]=i,this.data.layers.event(Laya.Event.ADDED)}toast(e){cc.Application.prompt(e,2e3)}}c._instance=null;class d extends Laya.EventDispatcher{constructor(){super()}static getInstance(){return this._instance||(this._instance=new d),this._instance}initData(){let e=document.body;e&&(e.onfocus=this.onfocus.bind(this),e.onblur=this.onblur.bind(this))}onfocus(){console.log("onfocus")}onblur(){console.log("onblur")}playSound(e){B.getInstance().data.soundMuted.value||YYGGames.audio.play("sounds/"+e,!1)}stopSound(e){YYGGames.audio.stop("sounds/"+e)}playMusic(e){B.getInstance().data.musicMuted.value||YYGGames.audio.play("sounds/"+e,!0)}stopMusic(e){YYGGames.audio.stop("sounds/"+e)}soundMute(){this.stopSound("attack.mp3"),this.stopSound("button.mp3"),this.stopSound("chooseright.mp3"),this.stopSound("choosewrong.mp3"),this.stopSound("getgold.mp3"),this.stopSound("getskill.mp3"),this.stopSound("levelup.mp3"),this.stopSound("licensing.mp3"),this.stopSound("win.mp3")}soundUnmute(){YYGGames.audio.pause=!1}}d._instance=null,function(e){e[e.blue=0]="blue",e[e.red=1]="red",e[e.yellow=2]="yellow"}(o||(o={})),function(e){e[e.init=-2]="init",e[e.shake=-1]="shake",e[e.levelUp=0]="levelUp",e[e.attack=1]="attack",e[e.getGold=2]="getGold"}(r||(r={}));class g{constructor(e,t){this.x=0,this.y=0,this.x=e,this.y=t,this.init()}init(){this.level=1,this.cardType=o.blue}set cell(e){this._cell=e,this._zOrder=this.cell.zOrder,this.cellInitX=e.x,this.cellInitY=e.y,this.image=e.getChildByName("img"),this.tipImg=e.getChildByName("tipImg"),this.tipImg&&(this.tipImg.visible=!1),this.reflashImage()}get cell(){return this._cell}set cardType(e){switch(this._cardType=e,this._cardType){case o.blue:this._skinPath="blue/";break;case o.red:this._skinPath="red/";break;case o.yellow:this._skinPath="yellow/"}}get cardType(){return this._cardType}set level(e){this._level=e,this.reflashImage()}get level(){return this._level}levelChange(e){this.cardType==o.yellow?e>5&&(e=5):e>15&&(e=15),this.level=e}reflashImage(){this.image&&(this.image.skin=this._skinPath+this._level+".jpg")}checkMove(e){return this._cardType==o.red?r.shake:this._cardType==o.yellow?e.cardType==o.red?r.shake:e.cardType==o.blue?e.level<this._level?r.shake:(S._instance.targetLevel=this.level,r.getGold):e.level!=this._level?r.shake:r.levelUp:e.cardType==o.blue?e.level!=this._level?r.shake:r.levelUp:e.level>this._level?r.shake:e.cardType==o.red?(S._instance.targetLevel=e.level,r.attack):e.cardType==o.yellow?(S._instance.targetLevel=e.level,r.getGold):void 0}setCardInfo(e,t){this.cardType=e,this.level=t}selectCard(){this.selectLine&&(this.selectLine.destroy(),this.selectLine=null),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.cell.zOrder=this._zOrder+1,this.cell.x=this.cellInitX,this.cell.y=this.cellInitY,this.selectLine=new Laya.TimeLine,this.selectLine.to(this.cell,{scaleX:1.3,scaleY:1.3},50).to(this.cell,{scaleX:1.2,scaleY:1.2},50),this.selectLine.play(0,!1),this.imgLight()}unSelectCard(){this.selectLine&&(this.selectLine.destroy(),this.selectLine=null),this.cell.scale(1,1),this.cell.zOrder=this._zOrder,this.imgOffLight()}imgLight(){if(this.cell.filters)return;let e=new Laya.ColorFilter;e.color(20,30,30,1),this.image.filters=[e]}imgOffLight(){this.image.filters=[]}cardLight(){let e;Laya.timer.clearAll(this);let t=new Laya.ColorFilter;this.cardType==o.yellow?(e=new Laya.GlowFilter("#fdff36",10,0,0),t.color(125,103,69,1)):(e=new Laya.GlowFilter("#ffffff",10,0,0),t.color(80,100,100,1)),this.cell.filters=[t,e],Laya.timer.once(350,this,()=>{this.cell.filters=[]})}cardAnimPlay(e){switch(e){case r.init:this.AnimInitPlay();break;case r.shake:this.AnimShakePlay();break;case r.levelUp:this.AnimLvlUpPlay();break;case r.attack:this.AnimAttackPlay();break;case r.getGold:this.AnimGetGoldPlay()}}waitSelect(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.cell.x=this.cellInitX,this.cell.y=this.cellInitY,this.timeLine=new Laya.TimeLine,this.timeLine.to(this.cell,{x:this.cellInitX-2},50).to(this.cell,{x:this.cellInitX},50).to(this.cell,{x:this.cellInitX+2},50).to(this.cell,{x:this.cellInitX},50).addLabel("end",0),this.timeLine.play(0,!0),this.timeLine.on(Laya.Event.LABEL,this,e=>{this.cell.x=this.cellInitX,this.cell.y=this.cellInitY})}waitCancel(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null,this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.cell.x=this.cellInitX,this.cell.y=this.cellInitY)}tipsShow(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null),this.tipImg.visible=!0,this.tipImg.alpha=0,this.timeLine=new Laya.TimeLine,this.timeLine.to(this.tipImg,{alpha:.5},500).to(this.tipImg,{alpha:0},500),this.timeLine.play(0,!0)}tipsCanel(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null,this.tipImg.visible=!1,this.tipImg.alpha=0)}AnimInitPlay(){Laya.Tween.to(this.cell,{x:this.cellInitX,y:this.cellInitY},300,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.x*this.y==16&&(S._instance.isStart=!0)}),60*(5*this.x+this.y))}AnimShakePlay(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.cell.x=this.cellInitX,this.cell.y=this.cellInitY,this.timeLine=new Laya.TimeLine,this.timeLine.to(this.cell,{x:this.cellInitX-10},50).to(this.cell,{x:this.cellInitX},50).to(this.cell,{y:this.cellInitY-10},50).to(this.cell,{y:this.cellInitY},50).to(this.cell,{x:this.cellInitX+10},50).to(this.cell,{x:this.cellInitX},50).to(this.cell,{y:this.cellInitY+10},50).to(this.cell,{y:this.cellInitY},50).addLabel("end",0),this.timeLine.play(0,!1),this.timeLine.on(Laya.Event.LABEL,this,e=>{this.cell.x=this.cellInitX,this.cell.y=this.cellInitY})}AnimLvlUpPlay(){this.timeLine&&(this.timeLine.destroy(),this.timeLine=null),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.timeLine=new Laya.TimeLine,this.timeLine.to(this.cell,{scaleX:-1},100).to(this.cell,{scaleX:1},100),this.timeLine.play(0,!1)}AnimAttackPlay(){Laya.Tween.clearAll(this.cell),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,Laya.Tween.from(this.cell,{scaleX:0,scaleY:0},200)}AnimGetGoldPlay(){Laya.Tween.clearAll(this.cell),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,Laya.Tween.from(this.cell,{rotation:-360,scaleX:0,scaleY:0},200)}MoveTo(e,t,i,s){Laya.Tween.clearAll(this.cell),this.cell.rotation=0,this.cell.scaleX=1,this.cell.scaleY=1,this.cell.zOrder=this._zOrder+50,Laya.Tween.to(this.cell,{x:e,y:t},200,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.cell.x=this.cellInitX,this.cell.y=this.cellInitY,this.setCardInfo(i,s),this.cell.zOrder=this._zOrder}))}}const y=["blue_1","blue_2","blue_3","blue_4","blue_5","blue_6","blue_7","blue_8","blue_9","blue_10","red_1","red_2","red_3","red_4","red_5","red_6","red_7","red_8","red_9","red_10","red_11","red_12","red_13","red_14","red_15","yellow_1","yellow_2","yellow_3"];class p{constructor(){this.weightJson=Laya.loader.getRes("data/nextCardWeight.json")}static get Instance(){return null==this._instance&&(this._instance=new p),this._instance}getNextCard(e){var t=new g(0,0);for(const l in this.weightJson){const n=this.weightJson[l];var i=n.round.split(",");if(e>=parseInt(i[0])&&e<=parseInt(i[1])){var s=this.getRandomByWeight(n);if(""!=s){var a=s.split("_");switch(a[0]){case"blue":t.cardType=o.blue;break;case"red":t.cardType=o.red;break;case"yellow":t.cardType=o.yellow}t.level=parseInt(a[1]);break}}}return t}random(e,t){return Math.floor(Math.random()*(t-e))+e}getRandomByWeight(e){let t=0;for(const i of y)t+=e[i];let i=this.random(0,t),s=0;for(;t>0;){if((t-=e[y[s]])<i)return y[s];s++}return""}}class u{constructor(e,t){this.nodes=[],this.array=[],this.waitSelectList=[],this.nodes=[],this.array=[];for(let i=0;i<e;i++){this.nodes[i]=[];for(let e=0;e<t;e++){const t=this.getInitCard(i,e);this.nodes[i][e]=t,this.array.push(t)}}}getInitCard(e,t){var i;return-1==B.getInstance().StepIndex?i=this.createRandomCard(e,t):(this.currentRecode=B.getInstance().getStepRecord(),(i=new g(e,t)).cardType=this.currentRecode.typeList[5*e+t],i.level=this.currentRecode.levelList[5*e+t]),i}createRandomCard(e,t){var i;return 0==e&&0==t?(i=new g(e,t)).setCardInfo(o.yellow,3):i=p.Instance.getNextCard(0),i.x=e,i.y=t,i}changeCard(e,t,i,s){this.nodes[e][t].setCardInfo(this.nodes[i][s].cardType,this.nodes[i][s].level)}reflashCardMaxInGameController(){for(let e=0;e<this.array.length;e++)S._instance.maxCardDataChange(this.array[e])}reflashCardListByRecord(e){console.log(e);for(let t=0;t<this.array.length;t++)this.array[t].setCardInfo(e.typeList[t],e.levelList[t])}redCardWaitSelect(){for(let e=0;e<this.array.length;e++)this.array[e].cardType==o.red&&(this.array[e].waitSelect(),this.waitSelectList.push(this.array[e]));return this.waitSelectList.length>0}BlueCardWaitSelect(){for(let e=0;e<this.array.length;e++)this.array[e].cardType==o.blue&&(this.array[e].waitSelect(),this.waitSelectList.push(this.array[e]));return this.waitSelectList.length>0}waitCancel(){for(let e=0;e<this.waitSelectList.length;e++)this.waitSelectList[e].waitCancel();this.waitSelectList=[]}checkHasMoveCard(){for(let e=0;e<this.array.length;e++)if(null!=this.checkCardCouldMove(this.array[e]))return!0;return!1}getCouldMoveCard(){var e=new Array(2);for(let t=0;t<this.array.length;t++)if(e[0]=this.checkCardCouldMove(this.array[t]),null!=e[0])return e[1]=this.array[t],e;return null}checkCardCouldMove(e){return e.x-1>=0&&e.checkMove(this.nodes[e.x-1][e.y])!=r.shake?this.nodes[e.x-1][e.y]:e.x+1<=4&&e.checkMove(this.nodes[e.x+1][e.y])!=r.shake?this.nodes[e.x+1][e.y]:e.y-1>=0&&e.checkMove(this.nodes[e.x][e.y-1])!=r.shake?this.nodes[e.x][e.y-1]:e.y+1<=4&&e.checkMove(this.nodes[e.x][e.y+1])!=r.shake?this.nodes[e.x][e.y+1]:null}reviveOperate(){var e=[];for(let t=0;t<this.array.length;t++)this.array[t].cardType==o.red&&e.push(this.array[t]);if(e.length<=7)for(var t=0;t<e.length;t++)e[t].setCardInfo(o.yellow,1);else{this.quickSort(e,0,e.length-1);for(t=e.length-1;t>=e.length-7;t--)e[t].setCardInfo(o.yellow,1)}}quickSort(e,t,i){if(t<i){var s=this.getIndex(e,t,i);this.quickSort(e,t,s-1),this.quickSort(e,s+1,i)}}getIndex(e,t,i){for(var s=e[t];t<i;){for(;t<i&&e[i].level>=s.level;)i--;for(e[t]=e[i];t<i&&e[t].level<=s.level;)t++;e[i]=e[t]}return e[t]=s,t}}var m,C;!function(e){e[e.reduce=0]="reduce",e[e.toGold=1]="toGold",e[e.swap=2]="swap"}(m||(m={}));class v extends Laya.Script{constructor(){super(...arguments),this.isNeverShow=!1}onAwake(){this.skillOneBox=this.owner.getChildByName("panel").getChildByName("skillOneBox"),this.skillTwoBox=this.owner.getChildByName("panel").getChildByName("skillTwoBox"),this.skillThreeBox=this.owner.getChildByName("panel").getChildByName("skillThreeBox"),this.neverShowBtn=this.owner.getChildByName("panel").getChildByName("neverShowBtn"),this.neverShowImg=this.neverShowBtn.getChildByName("img"),this.goOnBtn=this.owner.getChildByName("goOnBtn"),this.goOff=this.owner.getChildByName("goOff"),this.closeBtn=this.owner.getChildByName("closeBtn")}onEnable(){this.neverShowBtn.on(Laya.Event.CLICK,this,this.onNeverShowBtnCLick),this.goOnBtn.on(Laya.Event.CLICK,this,this.onGoOnBtnClick),this.closeBtn.on(Laya.Event.CLICK,this,this.onCloseBtnClick),this.init()}onDisable(){this.neverShowBtn.offAll(),this.goOnBtn.offAll(),this.closeBtn.offAll()}init(){this.type=this.owner._param[0];var e=this.owner._param[1];switch(this.goOff.visible=!1,this.type){case m.reduce:this.skillOneBox.visible=!0,this.skillTwoBox.visible=!1,this.skillThreeBox.visible=!1;break;case m.toGold:this.skillOneBox.visible=!1,this.skillTwoBox.visible=!0,this.skillThreeBox.visible=!1;break;case m.swap:this.skillOneBox.visible=!1,this.skillTwoBox.visible=!1,this.skillThreeBox.visible=!0}this.isNeverShow=!1,this.neverShowImg.visible=this.isNeverShow,e||(this.goOff.visible=!0,this.goOnBtn.visible=!1,this.goOnBtn.offAll())}onNeverShowBtnCLick(){d.getInstance().playSound("button.mp3"),this.isNeverShow=!this.isNeverShow,this.neverShowImg.visible=this.isNeverShow}onGoOnBtnClick(){switch(this.type){case m.reduce:this.isNeverShow&&(B.getInstance().skillOneTips=!1),S._instance.skillReduce();break;case m.toGold:this.isNeverShow&&(B.getInstance().skillTwoTips=!1),S._instance.skillToGold();break;case m.swap:this.isNeverShow&&(B.getInstance().skillThreeTips=!1),S._instance.skillSwap()}this.owner.close(),d.getInstance().playSound("button.mp3")}onCloseBtnClick(){switch(this.type){case m.reduce:this.isNeverShow&&(B.getInstance().skillOneTips=!1);break;case m.toGold:this.isNeverShow&&(B.getInstance().skillTwoTips=!1);break;case m.swap:this.isNeverShow&&(B.getInstance().skillThreeTips=!1)}this.owner.close(),S._instance.isWaiting=!0,d.getInstance().playSound("button.mp3")}}class w{constructor(e){this._name="___PARTICLE___"+ ++w.PARTICLEID,this._instance=e,this._instance.active=!1}set position(e){this._instance.transform.position=e}play(){if(this._instance.particleSystem.isPlaying){const e=Laya.Pool.getItemByCreateFun(this._name,this.init,this);e.transform.position=this._instance.transform.position,this._instance.parent.addChild(e),e.active=!0,e.particleSystem.play(),this._instance.parent.timer.once(1e3*e.particleSystem.duration,this,this.recover,[e])}else this._instance.active=!0,this._instance.particleSystem.play()}init(){return this._instance.clone()}recover(e){e.particleSystem.stop(),e.active=!1,e.removeSelf(),Laya.Pool.recover(this._name,e)}}w.PARTICLEID=1e3;class L extends Laya.Script{constructor(){super(...arguments),this._inited=!1}onAwake(){L._instance=this,this.skillImg=this.owner.getChildByName("skillImg"),this.isTween=!1,this._inited=!1,Laya.Scene3D.load("LayaScene_GameScene/Conventional/GameScene.ls",Laya.Handler.create(this,e=>{this.owner.addChild(e),this.uicamera=YYGGames.find("Main Camera",e),this.maxup=new w(YYGGames.find("maxup",e)),this.blue_levelup=new w(YYGGames.find("blue_levelup",e)),this.yellow_levelup=new w(YYGGames.find("yellow_levelup",e)),this.attack=new w(YYGGames.find("attack",e)),this.gold=new w(YYGGames.find("gold",e)),this.SkillEffect=YYGGames.find("SkillEffect",e),this.SkillEffect.active=!1,this._inited=!0}))}onUpdate(){if(this._inited&&this.isTween){var e=new Laya.Vector3(this.skillImg.x,this.skillImg.y,0);this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.SkillEffect.transform.position=e}}blueLevelUpPlay(e){this._inited&&(this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.blue_levelup.position=e,this.blue_levelup.play())}yellowLevelUpPlay(e){this._inited&&(this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.yellow_levelup.position=e,this.yellow_levelup.play())}attackPlay(e){this._inited&&(this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.attack.position=e,this.attack.play())}goldPlay(e){this._inited&&(this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.gold.position=e,this.gold.play())}maxUpPlay(e){this._inited&&(this.uicamera.convertScreenCoordToOrthographicCoord(e,e),this.maxup.position=e,this.maxup.play())}skillEffectTween(e,t,i){if(this._inited){this.isTween=!0,this.skillImg.pos(e.x,e.y);var s=e;this.uicamera.convertScreenCoordToOrthographicCoord(s,s),this.SkillEffect.transform.position=s,this.SkillEffect.active=!0,this.SkillEffect.particleSystem.play(),Laya.Tween.to(this.skillImg,{x:t.x,y:t.y},500,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{i&&i(),this.isTween=!1,this.SkillEffect.active=!1}))}}}!function(e){e.homeScene="Scene/HomeScene.scene",e.gameScene="Scene/GameScene.scene"}(C||(C={}));class S extends Laya.Script{onAwake(){S._instance=this,this.homeBtn=this.owner.getChildByName("topBox").getChildByName("homeBtn"),this.bgImg=this.owner.getChildByName("bg").getChildByName("img"),this.restartBtn=this.owner.getChildByName("topBox").getChildByName("restartBtn"),this.teachBtn=this.owner.getChildByName("mainPanel").getChildByName("teachBtn"),this.nextBox=this.owner.getChildByName("mainPanel").getChildByName("nextBg").getChildByName("nextBox"),this.nextImg=this.owner.getChildByName("mainPanel").getChildByName("nextBg").getChildByName("nextBox").getChildByName("img"),this.nextlevel=this.owner.getChildByName("mainPanel").getChildByName("nextBg").getChildByName("nextBox").getChildByName("level"),this.stepLabel=this.owner.getChildByName("mainPanel").getChildByName("stepLabel"),this.scoreLabel=this.owner.getChildByName("mainPanel").getChildByName("listBox").getChildByName("scoreLabel"),this.list=this.owner.getChildByName("mainPanel").getChildByName("listBox").getChildByName("list"),this.skillReduceBtn=this.owner.getChildByName("mainPanel").getChildByName("skillOneBtn"),this.skillToGoldBtn=this.owner.getChildByName("mainPanel").getChildByName("skillTwoBtn"),this.skillSwapBtn=this.owner.getChildByName("mainPanel").getChildByName("skillThreeBtn"),this.reduceCountLabel=this.skillReduceBtn.getChildByName("countImg").getChildByName("countLabel"),this.toGoldCountLabel=this.skillToGoldBtn.getChildByName("countImg").getChildByName("countLabel"),this.swapCountLabel=this.skillSwapBtn.getChildByName("countImg").getChildByName("countLabel"),this.unDoBtn=this.owner.getChildByName("mainPanel").getChildByName("unDoBtn"),this.sunImg=this.owner.getChildByName("mainPanel").getChildByName("moonImg").getChildByName("sunImg"),this.blueBox=this.owner.getChildByName("mainPanel").getChildByName("blueBox"),this.redBox=this.owner.getChildByName("mainPanel").getChildByName("redBox"),this.yellowBox=this.owner.getChildByName("mainPanel").getChildByName("yellowBox"),this.skillReduceImg=this.owner.getChildByName("skillReduceImg"),this.skillToGoldImg=this.owner.getChildByName("skillToGoldImg"),this.skillSwapImg=this.owner.getChildByName("skillSwapImg")}onEnable(){this.homeBtn.on(Laya.Event.CLICK,this,this.onHomeBtnClick),this.restartBtn.on(Laya.Event.CLICK,this,this.onRestartBtnClick),this.teachBtn.on(Laya.Event.CLICK,this,this.onTeachBtnClick),this.skillReduceBtn.on(Laya.Event.CLICK,this,this.onSkillReduceClick),this.skillToGoldBtn.on(Laya.Event.CLICK,this,this.onSkillToGoldClick),this.skillSwapBtn.on(Laya.Event.CLICK,this,this.onSkillSwapClick),this.unDoBtn.on(Laya.Event.CLICK,this,this.onUndoClick),this.init()}onDisable(){this.homeBtn.off(Laya.Event.CLICK,this,this.onHomeBtnClick),this.restartBtn.off(Laya.Event.CLICK,this,this.onRestartBtnClick),this.teachBtn.off(Laya.Event.CLICK,this,this.onTeachBtnClick),this.skillReduceBtn.off(Laya.Event.CLICK,this,this.onSkillReduceClick),this.skillToGoldBtn.off(Laya.Event.CLICK,this,this.onSkillToGoldClick),this.skillSwapBtn.off(Laya.Event.CLICK,this,this.onSkillSwapClick),this.unDoBtn.off(Laya.Event.CLICK,this,this.onUndoClick)}onUpdate(){this.isWaiting&&(this.tipTimer+=Laya.timer.delta,this.tipTimer>=5e3&&(this.isWaiting=!1,this.tipShow(),this.tipTimer=0))}tipShow(){this.tipCardArr=this.cardMng.getCouldMoveCard(),null!=this.tipCardArr&&(this.tipCardArr[0].tipsShow(),this.tipCardArr[1].tipsShow())}tipHide(){this.tipCardArr&&(this.tipCardArr[0].tipsCanel(),this.tipCardArr[1].tipsCanel(),this.tipCardArr=null,this.tipTimer=0)}init(){if(d.getInstance().stopMusic("bg1.mp3"),d.getInstance().playMusic("bg2.mp3"),B.getInstance().data.firstOpen.value)return c.getInstance().openLayer(h.teach),void(this.isStart=!1);this.isWaiting=!0,this.cardListInit(),d.getInstance().playSound("licensing.mp3"),this.maxCardInit(),-1==B.getInstance().StepIndex?this.addStep():(this.setNextCard(),this.reflashStepLabel(),this.reflashScoreLabel()),this.sunImgTween(),this.skillInit(),this.tipTimer=0,this.skillReduceImg.visible=!1,this.skillToGoldImg.visible=!1,this.skillSwapImg.visible=!1}cardListInit(){this.cardMng=null,this.cardMng=new u(5,5),this.list.renderHandler=new Laya.Handler(this,this.cardListRender),this.list.array=new Array(25),this.list.repeatX=5,this.list.repeatY=5,this.isMove=!1,this.isStart=!1,this.timer=0,this.listSpaceX=this.list.spaceX,this.listSpaceY=this.list.spaceY,this.moveXDistance=2*this.list.getCell(0).width+this.listSpaceX,this.moveYDistance=2*this.list.getCell(0).height+this.listSpaceY}sunImgTween(){var e=new Laya.TimeLine;e.to(this.sunImg,{rotation:360},24e4).addLabel("end",0),e.on(Laya.Event.LABEL,this,e=>{this.sunImg.rotation=0}),e.play(0,!0);var t=new Laya.TimeLine;t.to(this.bgImg,{x:this.bgImg.x+10,y:this.bgImg.y-10},2e3).to(this.bgImg,{x:this.bgImg.x-10,y:this.bgImg.y-10},4e3).to(this.bgImg,{x:this.bgImg.x,y:this.bgImg.y},2e3),t.play(0,!0)}setNextCard(){switch(this.nextCard=p.Instance.getNextCard(B.getInstance().StepIndex+1),this.nextCard.cell=this.nextBox,this.nextCard.cardType){case o.blue:this.nextImg.skin="next/blue.png",this.nextlevel.color="#1bfdf4";break;case o.red:this.nextImg.skin="next/red.png",this.nextlevel.color="#fb0014";break;case o.yellow:this.nextImg.skin="next/yellow.png",this.nextlevel.color="#fbc800"}this.nextlevel.text=this.nextCard.level.toString(),this.nextCard.cardAnimPlay(r.levelUp)}maxCardInit(){this.maxBlueCard=new g(0,0),this.maxBlueCard.cardType=o.blue,this.maxBlueCard.cell=this.blueBox,this.maxRedCard=new g(0,0),this.maxRedCard.cardType=o.red,this.maxRedCard.cell=this.redBox,this.maxYellowCard=new g(0,0),this.maxYellowCard.cardType=o.yellow,this.maxYellowCard.cell=this.yellowBox,this.cardMng.reflashCardMaxInGameController()}skillInit(){this.isReduceDoing=!1,this.isToGoldDoing=!1,this.isSwapDoing=!1,this.skillSwapInitBottom=this.skillSwapBtn.bottom,this.skillSwapInitCenterX=this.skillSwapBtn.centerX,this.reflashSkillLabel()}cardListRender(e,t){let i=t%5,s=Math.floor(t/5),a=this.cardMng.nodes[s][i];a.cell=e,e.x=-e.width,e.y=this.list.height,a.cardAnimPlay(r.init),a.levelChange(a.level),e.on(Laya.Event.MOUSE_OVER,this,this.onCardMouseOver,[s,i]),e.on(Laya.Event.MOUSE_OUT,this,this.onCardMouseOut,[s,i]),e.on(Laya.Event.MOUSE_DOWN,this,this.onCardMouseDown,[s,i])}onCardMouseOver(e,t){this.cardMng.nodes[e][t].imgLight()}onCardMouseOut(e,t){this.cardMng.nodes[e][t].imgOffLight()}onCardMouseDown(e,t){if(this.isStart&&!this.isMove)if(this.isReduceDoing)this.RedCardReduce(this.cardMng.nodes[e][t]);else if(this.isToGoldDoing)this.ToGold(this.cardMng.nodes[e][t]);else{if(this.isSwapDoing)return d.getInstance().playSound("chooseright.mp3"),void(null==this.swapSelectCard?(this.swapSelectCard=this.cardMng.nodes[e][t],this.swapSelectCard.waitSelect()):this.SwapCard(this.cardMng.nodes[e][t]));this.mouseDownX=Laya.stage.mouseX,this.mouseDownY=Laya.stage.mouseY,this.selectCard=this.cardMng.nodes[e][t],this.selectCard.cardType==o.red?(this.selectCard.cardAnimPlay(r.shake),this.selectCard=null,this.isWaiting=!0,this.tipTimer=0):this.selectCard.selectCard()}}onMouseMove(){if(!this.isMove&&this.selectCard){var e=Laya.stage.mouseX-this.mouseDownX,t=Laya.stage.mouseY-this.mouseDownY;if(Math.abs(e)>50&&Math.abs(e)>Math.abs(t))e>0?this.selectCard.y+1<5?this.moveTargetCard=this.cardMng.nodes[this.selectCard.x][this.selectCard.y+1]:this.animType=r.shake:this.selectCard.y-1>=0?this.moveTargetCard=this.cardMng.nodes[this.selectCard.x][this.selectCard.y-1]:this.animType=r.shake;else{if(!(Math.abs(t)>50&&Math.abs(t)>Math.abs(e)))return;t>0?this.selectCard.x+1<5?this.moveTargetCard=this.cardMng.nodes[this.selectCard.x+1][this.selectCard.y]:this.animType=r.shake:this.selectCard.x-1>=0?this.moveTargetCard=this.cardMng.nodes[this.selectCard.x-1][this.selectCard.y]:this.animType=r.shake}this.moveTargetCard&&(this.animType=this.selectCard.checkMove(this.moveTargetCard)),this.isMove=!0,Laya.timer.once(400,this,()=>{this.isMove=!1,this.moveTargetCard=null}),this.animType!=r.shake?(this.tipHide(),this.cardMove(this.selectCard),this.selectCard.unSelectCard(),this.selectCard=null,this.animType==r.attack?B.getInstance().updateScore(B.getInstance().stepScore+25*this.targetLevel):this.animType==r.getGold&&B.getInstance().updateScore(B.getInstance().stepScore+5*this.targetLevel)):(this.selectCard.cardAnimPlay(r.shake),this.moveTargetCard&&this.moveTargetCard.cardAnimPlay(r.shake),this.selectCard.unSelectCard(),this.selectCard=null,this.isWaiting=!0,this.tipTimer=0)}}getSkill(e){e.cardType==o.yellow&&(e.level>=3?(B.getInstance().isFirstGetSkill&&c.getInstance().openLayer(h.getSkillTip),this.randomSkillGet(e)):d.getInstance().playSound("getgold.mp3"))}randomSkillGet(e){var t=B.getInstance().getSkillNotFullCount();if(0!=t[0])if(d.getInstance().playSound("getskill.mp3"),1==t[0])1==t[1]?this.addSkill(0,e):1==t[2]?this.addSkill(1,e):1==t[3]&&this.addSkill(2,e);else if(2==t[0]){if(0==t[1])(i=Math.random())>=.5?this.addSkill(1,e):this.addSkill(2,e);else if(0==t[2]){(i=Math.random())>=.5?this.addSkill(0,e):this.addSkill(2,e)}else if(0==t[3]){(i=Math.random())>=.5?this.addSkill(0,e):this.addSkill(1,e)}}else{var i;0==(i=Math.round(2*Math.random()))?this.addSkill(0,e):1==i?this.addSkill(1,e):2==i&&this.addSkill(2,e)}else d.getInstance().playSound("getgold.mp3")}addSkill(e,t){B.getInstance().addSkillCount(e);var i,s,a=new Laya.Vector3(t.cell.parent.localToGlobal(new Laya.Point(t.cell.x,t.cell.y)).x,t.cell.parent.localToGlobal(new Laya.Point(t.cell.x,t.cell.y)).y,0);switch(e){case 0:s=this.skillReduceImg,i=new Laya.Vector3(this.skillReduceBtn.parent.localToGlobal(new Laya.Point(this.skillReduceBtn.x,this.skillReduceBtn.y)).x,this.skillReduceBtn.parent.localToGlobal(new Laya.Point(this.skillReduceBtn.x,this.skillReduceBtn.y)).y,0);break;case 1:s=this.skillToGoldImg,i=new Laya.Vector3(this.skillToGoldBtn.parent.localToGlobal(new Laya.Point(this.skillToGoldBtn.x,this.skillToGoldBtn.y)).x,this.skillToGoldBtn.parent.localToGlobal(new Laya.Point(this.skillToGoldBtn.x,this.skillToGoldBtn.y)).y,0);break;case 2:s=this.skillSwapImg,i=new Laya.Vector3(this.skillSwapBtn.parent.localToGlobal(new Laya.Point(this.skillSwapBtn.x,this.skillSwapBtn.y)).x,this.skillSwapBtn.parent.localToGlobal(new Laya.Point(this.skillSwapBtn.x,this.skillSwapBtn.y)).y,0)}s.pos(a.x,a.y),s.scaleX=1.5,s.scaleY=1.5,s.visible=!0,this.isStart=!1,Laya.Tween.to(s,{scaleX:2,scaleY:2,alpha:.5},500,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{s.visible=!1,L._instance.skillEffectTween(a,i,()=>{this.reflashSkillLabel(),this.isStart=!0})}))}onMouseUp(){this.selectCard&&(this.selectCard.unSelectCard(),this.selectCard=null,this.isWaiting=!0,this.tipTimer=0)}checkCardChange(e){if(this.animType==r.levelUp){d.getInstance().playSound("levelup.mp3");var t=new Laya.Vector3(this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).x,this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).y,0);this.moveTargetCard.cardType==o.blue?L._instance.blueLevelUpPlay(t):L._instance.yellowLevelUpPlay(t),this.moveTargetCard.levelChange(this.moveTargetCard.level+1),this.maxCardDataChange(this.moveTargetCard)}else if(this.animType==r.attack){d.getInstance().playSound("attack.mp3");t=new Laya.Vector3(this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).x,this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).y,0);L._instance.attackPlay(t),this.moveTargetCard.setCardInfo(e.cardType,e.level)}else if(this.animType==r.getGold){t=new Laya.Vector3(this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).x,this.moveTargetCard.cell.parent.localToGlobal(new Laya.Point(this.moveTargetCard.cell.x,this.moveTargetCard.cell.y)).y,0);L._instance.goldPlay(t),e.cardType==o.blue?(this.getSkill(this.moveTargetCard),this.moveTargetCard.setCardInfo(e.cardType,e.level)):this.getSkill(e)}this.moveTargetCard.cardLight()}cardMove(e){var t=e.x,i=e.y;t==this.moveTargetCard.x?e.y<this.moveTargetCard.y?Laya.Tween.to(e.cell,{x:e.cell.x+this.listSpaceX,rotation:5},100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{e.cell.rotation=0,e.cell.x-=this.listSpaceX,this.checkCardChange(e),this.cardMng.nodes[t][i+1].cardAnimPlay(this.animType);for(let e=i-1;e>=0;e--)this.cardMng.changeCard(t,e+1,t,e);this.nextCardIntoList(t,0),this.addStep();for(let e=i;e>=0;e--)Laya.Tween.from(this.cardMng.nodes[t][e].cell,{x:this.cardMng.nodes[t][e].cell.x-this.moveXDistance},200)})):Laya.Tween.to(e.cell,{x:e.cell.x-this.listSpaceX,rotation:-5},100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{e.cell.rotation=0,e.cell.x+=this.listSpaceX,this.checkCardChange(e),this.cardMng.nodes[t][i-1].cardAnimPlay(this.animType);for(let e=i+1;e<=4;e++)this.cardMng.changeCard(t,e-1,t,e);this.nextCardIntoList(t,4),this.addStep();for(let e=i;e<=4;e++)Laya.Tween.from(this.cardMng.nodes[t][e].cell,{x:this.cardMng.nodes[t][e].cell.x+this.moveXDistance},200)})):t<this.moveTargetCard.x?Laya.Tween.to(e.cell,{y:e.cell.y+this.listSpaceY},100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{e.cell.y-=this.listSpaceY,this.checkCardChange(e),this.cardMng.nodes[t+1][i].cardAnimPlay(this.animType);for(let e=t-1;e>=0;e--)this.cardMng.changeCard(e+1,i,e,i);this.nextCardIntoList(0,i),this.addStep();for(let e=t;e>=0;e--)Laya.Tween.from(this.cardMng.nodes[e][i].cell,{y:this.cardMng.nodes[e][i].cell.y-this.moveYDistance},200)})):Laya.Tween.to(e.cell,{y:e.cell.y-this.listSpaceY},100,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{e.cell.y+=this.listSpaceY,this.checkCardChange(e),this.cardMng.nodes[t-1][i].cardAnimPlay(this.animType);for(let e=t+1;e<=4;e++)this.cardMng.changeCard(e-1,i,e,i);this.nextCardIntoList(4,i),this.addStep();for(let e=t;e<=4;e++)Laya.Tween.from(this.cardMng.nodes[e][i].cell,{y:this.cardMng.nodes[e][i].cell.y+this.moveYDistance},200)}))}nextCardIntoList(e,t){this.cardMng.nodes[e][t].setCardInfo(this.nextCard.cardType,this.nextCard.level),this.maxCardDataChange(this.nextCard)}addStep(){this.setNextCard(),B.getInstance().setStepRecord(this.cardMng.array),this.reflashStepLabel(),this.reflashScoreLabel(),this.checkFinished(),this.isWaiting=!0,this.tipTimer=0}maxCardDataChange(e){e.cardType==o.blue?B.getInstance().currentBlueCardLvl<e.level&&B.getInstance().updateBlueCardLevel(e.level):e.cardType==o.red?B.getInstance().currentRedCardLvl<e.level&&B.getInstance().updateRedCardLevel(e.level):e.cardType==o.yellow&&B.getInstance().currentYellowCardLvl<e.level&&B.getInstance().updateYellowCardLevel(e.level),this.reflashMaxCard()}reflashMaxCard(){if(this.maxBlueCard.level<B.getInstance().currentBlueCardLvl){this.maxBlueCard.level=B.getInstance().currentBlueCardLvl,this.maxBlueCard.cardAnimPlay(r.levelUp);var e=new Laya.Vector3(this.maxBlueCard.cell.parent.localToGlobal(new Laya.Point(this.maxBlueCard.cell.x,this.maxBlueCard.cell.y+.75*this.maxBlueCard.cell.height)).x,this.maxBlueCard.cell.parent.localToGlobal(new Laya.Point(this.maxBlueCard.cell.x,this.maxBlueCard.cell.y+.75*this.maxBlueCard.cell.height)).y,0);L._instance&&L._instance.maxUpPlay(e)}if(this.maxRedCard.level<B.getInstance().currentRedCardLvl){this.maxRedCard.level=B.getInstance().currentRedCardLvl,this.maxRedCard.cardAnimPlay(r.levelUp);e=new Laya.Vector3(this.maxRedCard.cell.parent.localToGlobal(new Laya.Point(this.maxRedCard.cell.x,this.maxRedCard.cell.y+.75*this.maxRedCard.cell.height)).x,this.maxRedCard.cell.parent.localToGlobal(new Laya.Point(this.maxRedCard.cell.x,this.maxRedCard.cell.y+.75*this.maxRedCard.cell.height)).y,0);L._instance&&L._instance.maxUpPlay(e)}if(this.maxYellowCard.level<B.getInstance().currentYellowCardLvl){this.maxYellowCard.level=B.getInstance().currentYellowCardLvl,this.maxYellowCard.cardAnimPlay(r.levelUp);e=new Laya.Vector3(this.maxYellowCard.cell.parent.localToGlobal(new Laya.Point(this.maxYellowCard.cell.x,this.maxYellowCard.cell.y+.75*this.maxYellowCard.cell.height)).x,this.maxYellowCard.cell.parent.localToGlobal(new Laya.Point(this.maxYellowCard.cell.x,this.maxYellowCard.cell.y+.75*this.maxYellowCard.cell.height)).y,0);L._instance&&L._instance.maxUpPlay(e)}}reflashStepLabel(){this.stepLabel.text="Step: "+(B.getInstance().StepIndex+1).toString()}reflashScoreLabel(){this.scoreLabel.text=B.getInstance().stepScore.toString()}reflashSkillLabel(){this.reduceCountLabel.text=B.getInstance().skillOneCount.toString(),this.toGoldCountLabel.text=B.getInstance().skillTwoCount.toString(),this.swapCountLabel.text=B.getInstance().skillThreeCount.toString()}levelCompleted(){B.getInstance().levelComplete(),d.getInstance().playSound("win.mp3"),c.getInstance().openLayer(h.gameOver),this.isStart=!1}checkFinished(){this.cardMng.checkHasMoveCard()||(console.log("finished!"),this.levelCompleted())}onSkillReduceClick(){if(d.getInstance().playSound("button.mp3"),this.isStart&&!this.isMove)return this.isReduceDoing?(this.isReduceDoing=!1,this.isWaiting=!0,this.tipTimer=0,B.getInstance().addSkillCount(0),this.cardMng.waitCancel(),void this.reflashSkillLabel()):void(this.isToGoldDoing||this.isSwapDoing||this.isReduceDoing||(0!=B.getInstance().skillOneCount?B.getInstance().skillOneTips?c.getInstance().openLayer(h.skillTips,[m.reduce,!0]):this.skillReduce():c.getInstance().openLayer(h.skillTips,[m.reduce,!1])))}skillReduce(){this.tipHide(),B.getInstance().skillOneCount--,this.reflashSkillLabel(),this.cardMng.redCardWaitSelect()&&(this.isReduceDoing=!0)}onSkillToGoldClick(){if(d.getInstance().playSound("button.mp3"),this.isStart&&!this.isMove)return this.isToGoldDoing?(this.isToGoldDoing=!1,this.isWaiting=!0,this.tipTimer=0,B.getInstance().addSkillCount(1),this.cardMng.waitCancel(),void this.reflashSkillLabel()):void(this.isToGoldDoing||this.isSwapDoing||this.isReduceDoing||(0!=B.getInstance().skillTwoCount?B.getInstance().skillTwoTips?c.getInstance().openLayer(h.skillTips,[m.toGold,!0]):this.skillToGold():c.getInstance().openLayer(h.skillTips,[m.toGold,!1])))}skillToGold(){this.tipHide(),B.getInstance().skillTwoCount--,this.reflashSkillLabel(),this.cardMng.redCardWaitSelect(),this.cardMng.BlueCardWaitSelect()&&(this.isToGoldDoing=!0)}onSkillSwapClick(){if(d.getInstance().playSound("button.mp3"),this.isStart&&!this.isMove)return this.isSwapDoing?(this.isSwapDoing=!1,this.isWaiting=!0,this.tipTimer=0,B.getInstance().addSkillCount(2),this.swapShakeLine&&(this.swapShakeLine.destroy(),this.swapShakeLine=null,this.skillSwapBtn.bottom=this.skillSwapInitBottom,this.skillSwapBtn.centerX=this.skillSwapInitCenterX),this.swapSelectCard&&(this.swapSelectCard.waitCancel(),this.swapSelectCard=null),void this.reflashSkillLabel()):void(this.isToGoldDoing||this.isSwapDoing||this.isReduceDoing||(0!=B.getInstance().skillThreeCount?B.getInstance().skillThreeTips?c.getInstance().openLayer(h.skillTips,[m.swap,!0]):this.skillSwap():c.getInstance().openLayer(h.skillTips,[m.swap,!1])))}skillSwap(){this.tipHide(),B.getInstance().skillThreeCount--,this.reflashSkillLabel(),this.isSwapDoing=!0,this.swapBtnShakeTween()}RedCardReduce(e){e.cardType==o.red?(d.getInstance().playSound("chooseright.mp3"),e.level>3?e.levelChange(e.level-3):e.setCardInfo(o.yellow,1),this.cardMng.waitCancel(),e.cardAnimPlay(r.levelUp),this.isReduceDoing=!1,this.addStep()):d.getInstance().playSound("choosewrong.mp3")}ToGold(e){e.cardType!=o.yellow?(d.getInstance().playSound("chooseright.mp3"),e.setCardInfo(o.yellow,1),this.cardMng.waitCancel(),e.cardAnimPlay(r.levelUp),this.isToGoldDoing=!1,this.addStep()):d.getInstance().playSound("choosewrong.mp3")}swapBtnShakeTween(){this.swapShakeLine&&this.swapShakeLine.destroy(),this.swapShakeLine=new Laya.TimeLine,this.swapShakeLine.to(this.skillSwapBtn,{centerX:this.skillSwapInitCenterX-10},50).to(this.skillSwapBtn,{centerX:this.skillSwapInitCenterX},50).to(this.skillSwapBtn,{bottom:this.skillSwapInitBottom-10},50).to(this.skillSwapBtn,{bottom:this.skillSwapInitBottom},50).to(this.skillSwapBtn,{centerX:this.skillSwapInitCenterX+10},50).to(this.skillSwapBtn,{centerX:this.skillSwapInitCenterX},50).to(this.skillSwapBtn,{bottom:this.skillSwapInitBottom+10},50).to(this.skillSwapBtn,{bottom:this.skillSwapInitBottom},50),this.swapShakeLine.play(0,!0)}SwapCard(e){this.swapSelectCard.waitCancel(),e.MoveTo(this.swapSelectCard.cell.x,this.swapSelectCard.cell.y,this.swapSelectCard.cardType,this.swapSelectCard.level),this.swapSelectCard.MoveTo(e.cell.x,e.cell.y,e.cardType,e.level),this.swapSelectCard=null,this.isSwapDoing=!1,Laya.timer.once(205,this,this.addStep),this.swapShakeLine&&(this.swapShakeLine.destroy(),this.swapShakeLine=null,this.skillSwapBtn.bottom=this.skillSwapInitBottom,this.skillSwapBtn.centerX=this.skillSwapInitCenterX)}onUndoClick(){d.getInstance().playSound("button.mp3"),this.isStart&&this.isStart&&(this.isMove||this.isToGoldDoing||this.isSwapDoing||this.isReduceDoing||0!=B.getInstance().StepIndex&&(this.tipHide(),YYGGames.ads.showReward(()=>{this.Undo()},()=>{cc.Application.prompt("Failed to get the reward, please watch the ads to the end.")})))}Undo(){switch(B.getInstance().stepRecordUndo(),this.cardMng.reflashCardListByRecord(B.getInstance().getStepRecord()),this.reflashStepLabel(),this.reflashScoreLabel(),this.reflashMaxCard(),this.reflashSkillLabel(),this.nextCard.setCardInfo(B.getInstance().getStepRecord().nextCardType,B.getInstance().getStepRecord().nextCardLevel),this.nextCard.cell=this.nextBox,this.nextCard.cardType){case o.blue:this.nextImg.skin="next/blue.png",this.nextlevel.color="#1bfdf4";break;case o.red:this.nextImg.skin="next/red.png",this.nextlevel.color="#fb0014";break;case o.yellow:this.nextImg.skin="next/yellow.png",this.nextlevel.color="#fbc800"}this.nextlevel.text=this.nextCard.level.toString()}reviveOperate(){this.Undo(),this.cardMng.reviveOperate(),B.getInstance().isRevive=!0,this.isStart=!0,this.addStep()}onHomeBtnClick(){YYGGames.ads.showInterstitial(()=>{d.getInstance().playSound("button.mp3"),c.getInstance().openScene(C.homeScene)})}onRestartBtnClick(){d.getInstance().playSound("button.mp3"),c.getInstance().openLayer(h.tips)}onTeachBtnClick(){d.getInstance().playSound("button.mp3"),c.getInstance().openLayer(h.teach)}}class B extends t{constructor(){super(),this.storage={key:"Gods-War-Merge",soundMuted:!1,musicMuted:!1,firstOpen:!0,blueCardLevel:1,redCardLevel:1,yellowCardLevel:1,bestScore:0},this.stepList=[]}static getInstance(){return this._instance||(this._instance=new B),this._instance}initData(){this.data=new a,this.storage=this.getStorageSync(this.storage.key)||this.storage,this.data.soundMuted.value=this.storage.soundMuted,this.data.musicMuted.value=this.storage.musicMuted,this.data.firstOpen.value=this.storage.firstOpen,this.data.blueCardLevel.value=this.storage.blueCardLevel,this.data.redCardLevel.value=this.storage.redCardLevel,this.data.yellowCardLevel.value=this.storage.yellowCardLevel,this.data.bestScore.value=this.storage.bestScore,this.data.soundMuted.on(this,this.onSoundMuted),this.onSoundMuted(this.storage.soundMuted),this.skillOneCount=0,this.skillTwoCount=0,this.skillThreeCount=0,this.currentBlueCardLvl=1,this.currentRedCardLvl=1,this.currentYellowCardLvl=1,this.skillOneTips=!0,this.skillTwoTips=!0,this.skillThreeTips=!0,this.stepIndex=-1,this.stepScore=0,this.isRevive=!1,this.isFirstGetSkill=!0}onSoundMuted(e){this.storage.soundMuted=e,this.storage.soundMuted?d.getInstance().soundMute():d.getInstance().soundUnmute(),this.setStorageSync(this.storage.key,this.storage)}onMusicMuted(e,t){this.storage.musicMuted=e,this.storage.musicMuted?(d.getInstance().stopMusic("bg1.mp3"),d.getInstance().stopMusic("bg2.mp3")):(console.log("num:"+t),0==t?d.getInstance().playMusic("bg1.mp3"):d.getInstance().playMusic("bg2.mp3")),this.setStorageSync(this.storage.key,this.storage)}levelComplete(){}addSkillCount(e){switch(this.isFirstGetSkill&&(this.isFirstGetSkill=!1),e){case 0:this.skillOneCount++;break;case 1:this.skillTwoCount++;break;case 2:this.skillThreeCount++}}getSkillNotFullCount(){var e=[0,0,0,0];return this.skillOneCount<2&&(e[0]++,e[1]=1),this.skillTwoCount<2&&(e[0]++,e[2]=1),this.skillThreeCount<2&&(e[0]++,e[3]=1),e}updateBlueCardLevel(e){this.currentBlueCardLvl=e,e>this.storage.blueCardLevel&&(this.storage.blueCardLevel=e,this.data.blueCardLevel.value=this.storage.blueCardLevel),this.setStorageSync(this.storage.key,this.storage)}updateRedCardLevel(e){this.currentRedCardLvl=e,e>this.storage.redCardLevel&&(this.storage.redCardLevel=e,this.data.redCardLevel.value=this.storage.redCardLevel),this.setStorageSync(this.storage.key,this.storage)}updateYellowCardLevel(e){this.currentYellowCardLvl=e,e>this.storage.yellowCardLevel&&(this.storage.yellowCardLevel=e,this.data.yellowCardLevel.value=this.storage.yellowCardLevel),this.setStorageSync(this.storage.key,this.storage)}updateScore(e){this.stepScore=e,e>this.storage.bestScore&&(this.storage.bestScore=e,this.data.bestScore.value=this.storage.bestScore),this.setStorageSync(this.storage.key,this.storage)}get StepIndex(){return this.stepIndex}setFirstOpenChange(){this.storage.firstOpen=!1,this.data.firstOpen.value=this.storage.firstOpen,this.setStorageSync(this.storage.key,this.storage)}setStepRecord(e){this.currentRecord=new l;for(let t=0;t<25;t++)this.currentRecord.typeList.push(e[t].cardType),this.currentRecord.levelList.push(e[t].level);this.currentRecord.skillOneCount=this.skillOneCount,this.currentRecord.skillTwoCount=this.skillTwoCount,this.currentRecord.skillThreeCount=this.skillThreeCount,this.currentRecord.stepScore=this.stepScore,this.currentRecord.stepBlueLevel=this.currentBlueCardLvl,this.currentRecord.stepRedLevel=this.currentRedCardLvl,this.currentRecord.stepYellowLevel=this.currentYellowCardLvl,this.currentRecord.nextCardType=S._instance.nextCard.cardType,this.currentRecord.nextCardLevel=S._instance.nextCard.level,this.stepList.push(this.currentRecord),this.stepIndex=this.stepList.length-1}clearStepRecord(){this.stepList=[],this.stepIndex=-1,this.currentBlueCardLvl=1,this.currentRedCardLvl=1,this.currentYellowCardLvl=1,this.skillOneCount=0,this.skillTwoCount=0,this.skillThreeCount=0,this.stepScore=0,this.isRevive=!1}stepRecordUndo(){this.stepList.splice(this.StepIndex,1),this.stepIndex=this.stepList.length-1,this.stepScore=this.getStepRecord().stepScore,this.currentBlueCardLvl=this.getStepRecord().stepBlueLevel,this.currentRedCardLvl=this.getStepRecord().stepRedLevel,this.currentYellowCardLvl=this.getStepRecord().stepYellowLevel}getStepRecord(){return-1==this.stepIndex?null:this.stepList[this.stepIndex]}}B._instance=null;class k extends Laya.Script{constructor(){super()}onAwake(){this.scoreLabel=this.owner.getChildByName("panel").getChildByName("score"),this.bestScoreLabel=this.owner.getChildByName("panel").getChildByName("bestImg").getChildByName("bestScore"),this.curBlueBox=this.owner.getChildByName("panel").getChildByName("curBlueBox"),this.curRedBox=this.owner.getChildByName("panel").getChildByName("curRedBox"),this.curYellowBox=this.owner.getChildByName("panel").getChildByName("curYellowBox"),this.bestBlueBox=this.owner.getChildByName("panel").getChildByName("bestBlueBox"),this.bestRedBox=this.owner.getChildByName("panel").getChildByName("bestRedBox"),this.bestYellowBox=this.owner.getChildByName("panel").getChildByName("bestYellowBox"),this.restartBtn=this.owner.getChildByName("panel").getChildByName("restartBtn"),this.reviveBtn=this.owner.getChildByName("panel").getChildByName("reviveBtn")}onEnable(){this.restartBtn.on(Laya.Event.CLICK,this,this.onRestartClick),this.reviveBtn.on(Laya.Event.CLICK,this,this.onReviveClick),this.init()}onDisable(){this.restartBtn.off(Laya.Event.CLICK,this,this.onRestartClick),this.reviveBtn.off(Laya.Event.CLICK,this,this.onReviveClick)}init(){this.scoreLabel.text=B.getInstance().stepScore.toString(),this.bestScoreLabel.text=B.getInstance().data.bestScore.value.toString();var e=new g(0,0);e.cell=this.curBlueBox,e.cardType=o.blue,e.level=B.getInstance().currentBlueCardLvl;var t=new g(0,0);t.cell=this.curRedBox,t.cardType=o.red,t.level=B.getInstance().currentRedCardLvl;var i=new g(0,0);i.cell=this.curYellowBox,i.cardType=o.yellow,i.level=B.getInstance().currentYellowCardLvl;var s=new g(0,0);s.cell=this.bestBlueBox,s.cardType=o.blue,s.level=B.getInstance().data.blueCardLevel.value;var a=new g(0,0);a.cell=this.bestRedBox,a.cardType=o.red,a.level=B.getInstance().data.redCardLevel.value;var l=new g(0,0);l.cell=this.bestYellowBox,l.cardType=o.yellow,l.level=B.getInstance().data.yellowCardLevel.value,B.getInstance().isRevive&&(this.reviveBtn.visible=!1,this.restartBtn.centerX=0)}onReviveClick(){YYGGames.ads.showReward(()=>{this.owner.close(),S._instance.reviveOperate(),d.getInstance().playSound("button.mp3")},()=>{cc.Application.prompt("Failed to get the reward, please watch the ads to the end.")})}onRestartClick(){YYGGames.ads.showInterstitial(()=>{this.owner.close(),d.getInstance().playSound("button.mp3"),B.getInstance().clearStepRecord(),c.getInstance().openScene(C.gameScene)})}}class I extends Laya.Script{onAwake(){this.noBtn=this.owner.getChildByName("goOnBtn")}onEnable(){this.noBtn.on(Laya.Event.CLICK,this,()=>{this.owner.close(),d.getInstance().playSound("button.mp3")}),this.init()}onDisable(){this.noBtn.offAll()}init(){}}class x extends Laya.Script{constructor(){super(...arguments),this.isFirstShow=!1,this.isNext=!1,this.isBox1MouseDown=!1,this.isBox2MouseDown=!1,this.mouseX=0}onAwake(){this.panel=this.owner.getChildByName("panel"),this.okBtn=this.owner.getChildByName("okBtn"),this.label=this.okBtn.getChildByName("label"),this.teach1Box=this.panel.getChildByName("teach1Box"),this.teach2Box=this.panel.getChildByName("teach2Box"),this.blueCard=this.teach1Box.getChildByName("blueCard"),this.yellowCard=this.teach1Box.getChildByName("yellowCard"),this.page1Btn=this.panel.getChildByName("page1Btn"),this.page2Btn=this.panel.getChildByName("page2Btn"),this.img1=this.page1Btn.getChildByName("img"),this.img2=this.page2Btn.getChildByName("img")}onEnable(){this.okBtn.on(Laya.Event.CLICK,this,this.closeBtnClick),this.page1Btn.on(Laya.Event.CLICK,this,this.onPageOneClick),this.page2Btn.on(Laya.Event.CLICK,this,this.onPageTwoClick),this.init()}onDisable(){this.okBtn.off(Laya.Event.CLICK,this,this.closeBtnClick),this.page1Btn.off(Laya.Event.CLICK,this,this.onPageOneClick),this.page2Btn.off(Laya.Event.CLICK,this,this.onPageTwoClick)}init(){this.img1.visible=!1,this.img2.visible=!1,this.filter=new Laya.ColorFilter,this.filter.color(80,100,100,1),this.blueInitPos=this.blueCard.centerX,this.yellowInitPos=this.yellowCard.centerX;var e=new Laya.TimeLine;e.to(this.blueCard,{centerX:this.yellowInitPos},500).to(this.blueCard,{centerX:this.yellowInitPos},1e3).to(this.blueCard,{centerX:this.blueInitPos},1).to(this.yellowCard,{centerX:this.blueInitPos},500).to(this.yellowCard,{centerX:this.blueInitPos},1e3).to(this.yellowCard,{centerX:this.yellowInitPos},1),e.play(0,!0),this.isFirstShow=!1,this.isBox1MouseDown=!1,this.isBox2MouseDown=!1,B.getInstance().data.firstOpen.value?(this.isFirstShow=!0,this.isNext=!0,this.label.text="NEXT",this.page1Btn.visible=!1,this.page2Btn.visible=!1,this.teach2Box.centerX=0,this.teach2Box.visible=!1,B.getInstance().setFirstOpenChange()):(this.isFirstShow=!1,this.onePageBtnLight(),this.teach2Box.centerX=750,this.teach2Box.alpha=0,this.teach1Box.on(Laya.Event.MOUSE_DOWN,this,()=>{this.isBox1MouseDown=!0,this.mouseX=Laya.stage.mouseX}),this.teach2Box.on(Laya.Event.MOUSE_DOWN,this,()=>{this.isBox2MouseDown=!0,this.mouseX=Laya.stage.mouseX}))}onMouseMove(){this.isBox1MouseDown&&this.mouseX-Laya.stage.mouseX>100&&(this.isBox1MouseDown=!1,this.onPageTwoClick()),this.isBox2MouseDown&&Laya.stage.mouseX-this.mouseX>100&&(this.isBox2MouseDown=!1,this.onPageOneClick())}onMouseUp(){this.isBox1MouseDown=!1,this.isBox2MouseDown=!1}onMouseOut(){this.isBox1MouseDown=!1,this.isBox2MouseDown=!1}onPageOneClick(){this.PageRightTween(),this.onePageBtnLight(),d.getInstance().playSound("button.mp3")}onPageTwoClick(){this.PageLeftTween(),this.twoPageBtnLight(),d.getInstance().playSound("button.mp3")}onePageBtnLight(){this.page1Btn.filters=[this.filter],this.page2Btn.filters=[]}twoPageBtnLight(){this.page1Btn.filters=[],this.page2Btn.filters=[this.filter]}PageLeftTween(){Laya.Tween.to(this.teach1Box,{centerX:-750,alpha:0},200),Laya.Tween.to(this.teach2Box,{centerX:0,alpha:1},200)}PageRightTween(){Laya.Tween.to(this.teach1Box,{centerX:0,alpha:1},200),Laya.Tween.to(this.teach2Box,{centerX:750,alpha:0},200)}closeBtnClick(){d.getInstance().playSound("button.mp3"),this.isFirstShow?this.isNext?(this.teach1Box.visible=!1,this.teach2Box.visible=!0,this.label.text="OK",this.isNext=!1):(this.owner.close(),B.getInstance().setFirstOpenChange(),S._instance.isStart=!0,S._instance.isWaiting=!0,c.getInstance().openScene(C.gameScene)):this.owner.close()}}class f extends Laya.Script{onAwake(){this.yesBtn=this.owner.getChildByName("panel").getChildByName("yesBtn"),this.noBtn=this.owner.getChildByName("panel").getChildByName("noBtn")}onEnable(){this.noBtn.on(Laya.Event.CLICK,this,()=>{this.owner.close(),d.getInstance().playSound("button.mp3")}),this.yesBtn.on(Laya.Event.CLICK,this,this.onRestartEvent),this.init()}onDisable(){this.noBtn.offAll(),this.yesBtn.offAll()}init(){}onRestartEvent(){YYGGames.ads.showInterstitial(()=>{this.owner.close(),B.getInstance().clearStepRecord(),c.getInstance().openScene(C.gameScene),d.getInstance().playSound("button.mp3")})}}class b extends Laya.Script{onStart(){this.owner.skin=B.getInstance().data.soundMuted.value?"UI/music_off.png":"UI/music_on.png"}onMouseDown(){B.getInstance().data.soundMuted.value=!B.getInstance().data.soundMuted.value,B.getInstance().onSoundMuted(B.getInstance().data.soundMuted.value),this.owner.skin=B.getInstance().data.soundMuted.value?"UI/music_off.png":"UI/music_on.png",d.getInstance().playSound("button.mp3")}}class T extends Laya.Script{constructor(){super(...arguments),this.bgID=0}onStart(){this.owner.skin=B.getInstance().data.musicMuted.value?"UI/mu_off.png":"UI/mu.png"}onMouseDown(){B.getInstance().data.musicMuted.value=!B.getInstance().data.musicMuted.value,B.getInstance().onMusicMuted(B.getInstance().data.musicMuted.value,this.bgID),this.owner.skin=B.getInstance().data.musicMuted.value?"UI/mu_off.png":"UI/mu.png",d.getInstance().playSound("button.mp3")}}class M extends Laya.Script{constructor(){super(...arguments),this.scene=""}onMouseDown(){YYGGames.navigate(this.scene,"LOGO")}}class _ extends Laya.Script{onAwake(){this.bg=this.owner.getChildByName("bg"),this.bgImg=this.bg.getChildByName("img"),this.Player=this.owner.getChildByName("Player"),this.title=this.owner.getChildByName("topBox").getChildByName("title"),this.continueBtn=this.owner.getChildByName("mainPanel").getChildByName("continueBtn"),this.unContinue=this.owner.getChildByName("mainPanel").getChildByName("unContinue"),this.playBtn=this.owner.getChildByName("mainPanel").getChildByName("playBtn"),this.scoreBox=this.owner.getChildByName("mainPanel").getChildByName("scoreBox"),this.scoreLabel=this.scoreBox.getChildByName("score"),this.blueBox=this.scoreBox.getChildByName("blue"),this.redBox=this.scoreBox.getChildByName("red"),this.yellowBox=this.scoreBox.getChildByName("yellow"),this.effect=this.owner.getChildByName("effect"),Laya.Scene3D.load("LayaScene_SampleScene/Conventional/SampleScene.ls",Laya.Handler.create(this,e=>{this.effect.addChild(e),this.uicamera=YYGGames.find("Main Camera",e),this.glowing=YYGGames.find("Glowing",e),this.v3=new Laya.Vector3(this.effect.x,this.effect.y),this.uicamera.convertScreenCoordToOrthographicCoord(this.v3,this.v3),this.glowing.transform.localPosition=this.v3}))}onEnable(){this.playBtn.on(Laya.Event.CLICK,this,this.startBtnClick),this.continueBtn.on(Laya.Event.CLICK,this,this.continueBtnClick)}onDisable(){this.playBtn.off(Laya.Event.CLICK,this,this.startBtnClick),this.continueBtn.off(Laya.Event.CLICK,this,this.continueBtnClick)}onStart(){this.initPanel()}initPanel(){-1==B.getInstance().StepIndex?(this.continueBtn.visible=!1,this.unContinue.visible=!0):(this.continueBtn.visible=!0,this.unContinue.visible=!1),this.tweenMoveContrl(),this.bestScoreSet(),d.getInstance().stopMusic("bg2.mp3"),d.getInstance().playMusic("bg1.mp3")}tweenMoveContrl(){var e=new Laya.TimeLine;e.to(this.bgImg,{x:this.bgImg.x+10,y:this.bgImg.y-10},2e3).to(this.bgImg,{x:this.bgImg.x-10,y:this.bgImg.y-10},4e3).to(this.bgImg,{x:this.bgImg.x,y:this.bgImg.y},2e3),e.play(0,!0);var t=new Laya.TimeLine;t.to(this.bg,{x:this.bg.x+10,y:this.bg.y-10},4e3).to(this.bg,{x:this.bg.x-10,y:this.bg.y-10},8e3).to(this.bg,{x:this.bgImg.x,y:this.bg.y},4e3),t.play(0,!0);var i=new Laya.TimeLine;i.to(this.Player,{x:this.Player.x-10,y:this.Player.y+10},2e3).to(this.Player,{x:this.Player.x+10,y:this.Player.y+10},4e3).to(this.Player,{x:this.Player.x,y:this.Player.y},2e3),i.play(0,!0);var s=new Laya.TimeLine;s.to(this.effect,{x:this.effect.x+20,y:this.effect.y},4e3).to(this.effect,{x:this.effect.x-30,y:this.effect.y},6e3).to(this.effect,{x:this.effect.x,y:this.effect.y},2e3),s.play(0,!0)}onUpdate(){this.uicamera&&this.glowing&&(this.v3=new Laya.Vector3(this.effect.x,this.effect.y),this.uicamera.convertScreenCoordToOrthographicCoord(this.v3,this.v3),this.glowing.transform.localPosition=this.v3)}bestScoreSet(){var e=new g(0,0);e.cell=this.blueBox,e.cardType=o.blue,e.level=B.getInstance().data.blueCardLevel.value;var t=new g(0,0);t.cell=this.redBox,t.cardType=o.red,t.level=B.getInstance().data.redCardLevel.value;var i=new g(0,0);i.cell=this.yellowBox,i.cardType=o.yellow,i.level=B.getInstance().data.yellowCardLevel.value,this.scoreLabel.text="Best: "+B.getInstance().data.bestScore.value.toString()}startBtnClick(){YYGGames.ads.showInterstitial(()=>{B.getInstance().clearStepRecord(),c.getInstance().openScene(C.gameScene),d.getInstance().playSound("button.mp3")})}continueBtnClick(){YYGGames.ads.showInterstitial(()=>{c.getInstance().openScene(C.gameScene),d.getInstance().playSound("button.mp3")})}}class N{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("components/ButtonEffect.ts",e),t("Layers/GameOverController.ts",k),t("Layers/GetSkillTipController.ts",I),t("Layers/SkillTipsController.ts",v),t("Layers/TeachController.ts",x),t("Layers/TipsController.ts",f),t("components/SoundsNode.ts",b),t("components/MusicNode.ts",T),t("components/YADNavigate.ts",M),t("scenes/GameController.ts",S),t("scenes/GameEffectController.ts",L),t("scenes/HomeController.ts",_)}}function onStartup(){document.getElementById("splash").style.display="none",UIConfig.popupBgAlpha=.8,B.getInstance().initData(),N.startScene&&Laya.Scene.open(N.startScene),console.timeEnd("perload")}N.width=1080,N.height=1920,N.scaleMode="exactfit",N.screenMode="none",N.alignV="middle",N.alignH="center",N.startScene="Scene/HomeScene.scene",N.sceneRoot="",N.debug=!1,N.stat=!1,N.physicsDebug=!1,N.exportSceneToJson=!0,N.init(),YYGGames.init("Gods-War-Merge",N,!1).then(function(){console.time("perload");const e=document.getElementById("progress");YYGGames.loader.perload(onStartup,t=>{e&&(e.value=100*t)})})}();